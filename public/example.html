<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico"/>
  <link rel="stylesheet" href="example.css"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#000000"/>
  <meta
      name="description"
      content="StylAbleZ"
  />
  <title>StylAbleZ</title>
  <style>
  </style>
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div class="container" role="main">
  <h1><a href="/article-url"></a></h1>
  <form method="post" action="https://css-tricks.com/examples/DragAndDropFileUploading//?"
        enctype="multipart/form-data" novalidate class="box">
    <div class="box__input">
      <svg class="box__icon" xmlns="http://www.w3.org/2000/svg" width="50" height="43"
           viewBox="0 0 50 43">
        <path
            d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"/>
      </svg>
      <input type="file" name="files[]" id="file" class="box__file" data-multiple-caption="{count} files selected" multiple/>
      <label for="file"><strong>Choose a file</strong><span class="box__dragndrop"> or drag it here</span>.</label>
      <button type="submit" class="box__button">Upload</button>
    </div>
    <div class="box__uploading">Uploading&hellip;</div>
    <div class="box__success">Done! <a
        href="https://css-tricks.com/examples/DragAndDropFileUploading//?" class="box__restart"
        role="button">Upload more?</a></div>
    <div class="box__error">Error! <span></span>. <a
        href="https://css-tricks.com/examples/DragAndDropFileUploading//?" class="box__restart"
        role="button">Try again!</a></div>
  </form>
  <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
    <p>Drag one or more files to this Drop Zone ...</p>
  </div>
  <footer>
    <p><strong>Select multiple files and drag them here to render the layers as a StylAbleZ
      image.</strong></p>
  </footer>
</div>
<script>

    function dropHandler(ev) {
        evt.stopPropagation();
        evt.preventDefault();

        if (ev.dataTransfer.items) {
            // Use DataTransferItemList interface to access the file(s)
            for (var i = 0; i < ev.dataTransfer.items.length; i++) {
                // If dropped items aren't files, reject them
                if (ev.dataTransfer.items[i].kind === 'file') {
                    var file = ev.dataTransfer.items[i].getAsFile();
                    console.log('... file[' + i + '].name = ' + file.name);
                }
            }
        } else {
            // Use DataTransfer interface to access the file(s)
            for (var i = 0; i < ev.dataTransfer.files.length; i++) {
                console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
            }
        }
    }
    function dragOverHandler(ev) {
        evt.stopPropagation();
        evt.preventDefault();
    }


    // FireReader event handlers
    var fileReader = (function() {
        return {
            loadStart: function(file) {
                return function(e) {
                    console.log("loadStart: "+e);

                    var uploading = $("<div></div>");
                    uploading.addClass("thumbnail");
                    uploading.append('<span>'+file.name+'</span><br /><img id="'+idOf('img',file)+'" src=""><br /><progress id="'+idOf('pg',file)+'" value="0" max="100"></progress>');
                    $('#upload-status').append(uploading);
                };
            },
            progress: function(file) {
                return function(e) {
                    console.log("progress");

                    var progressBar = $('#'+idOf('pg',file));

                    if (e.lengthComputable) {
                        var loaded = (e.loaded / e.total);
                        console.log(e.loaded + '/' + e.total + '/' + loaded);
                        if (loaded < 1) {
                            progressBar.val(loaded * maxPercentLocalUpload);
                        }
                    } else {
                        console.log("not lengthComputable");
                        progressBar.val(maxPercentLocalUpload);
                    }
                }
            },
            load: function(file) {
                return function(e) {
                    console.log("load");

                    var progressBar = $('#'+idOf('pg',file));
                    progressBar.val(maxPercentLocalUpload);

                    // show thumbnail
                    var img = $('#'+idOf('img',file));
                    img.attr('src',e.target.result);

                    // store to local storage
                    localStorage[idOf('ls',file)] = JSON.stringify({
                        file: file,
                        data: e.target.result
                    });
                    updateImagesLocal();

                }
            },
        };
    })();
</script>
</body>
</html>
